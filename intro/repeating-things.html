
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Repeating things - Nice R Code</title>
  <meta name="author" content="Rich FitzJohn & Daniel Falster">

  
  <meta name="description" content="Repeating things 18 March 2013 If there is one piece of advice I would recommend keeping in your
head when working with R, it is this: Don’t Repeat &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://nicercode.github.com/intro/repeating-things.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Nice R Code" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='http://fonts.googleapis.com/css?family=Bitter:400,700,400italic' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- mathjax config similar to math.stackexchange -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
});
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39493992-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body    class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Nice R Code</a></h1>
  
    <h2>Punning code better since 2013</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:nicercode.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/guide.html">Guides</a></li>
  <li><a href="/modules">Modules</a></li>
  <li><a href="/about">About</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <header>
    <h1 class="entry-title">Repeating things</h1>
    <p class="meta">








  


<time datetime="2013-03-18T10:25:00+11:00" pubdate data-updated="true">18 March 2013</time></p>
  </header>
  
  <p>If there is one piece of advice I would recommend keeping in your
head when working with R, it is this:</p>

<blockquote>
  <p>Don’t Repeat Yourself</p>
</blockquote>

<p>Many of the headaches that people end up having stem from repeating
themselves.  This basically mortgages your future time.  It is
common to see cases where people have copy-and-pasted some piece of
code a bunch of times (changing one thing each time), then copy and
pasted <em>that</em> a bunch of times, changing it a bit more.  In the
end, the script is very long, hard to read, really hard to
understand, and full of bugs.</p>

<p>Believe me on the last case — you <em>will</em> write code that has
bugs.  The more code you write, the more bugs you will have.  The
good thing is that unlike Excel bugs, you can see and find them.
The other goood thing is that the less code you write, the more
easily you will spot the bugs.</p>

<p>There are many ways of ensuring that you don’t repeat yourself.
Mastering the different approaches can take many years.  However,
try to notice when you feel like you are battling against the
language, and you’ll get a good hint for when you should be doing
something differently.</p>

<h1 id="applying-a-function-over-and-over-and-over-and-over">Applying a function over and over and over and over</h1>

<p>We’ll be using the data set again, with factors sorted
alphabetically as discussed in the <a href="data-types.html">last section</a>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">data <span class="o">&lt;-</span> read.csv<span class="p">(</span><span class="s">&quot;data/seed_root_herbivores.csv&quot;</span><span class="p">,</span> stringsAsFactors <span class="o">=</span> <span class="kc">FALSE</span><span class="p">)</span>
</span><span class="line">data<span class="o">$</span>Plot <span class="o">&lt;-</span> factor<span class="p">(</span>data<span class="o">$</span>Plot<span class="p">,</span> levels <span class="o">=</span> unique<span class="p">(</span>data<span class="o">$</span>Plot<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>There are a few data columns in the data set that we’ve been
using.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">head<span class="p">(</span>data<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##     Plot Seed.herbivore Root.herbivore No.stems Height Weight Seed.heads</span>
</span><span class="line"><span class="c1">## 1 plot-2           TRUE           TRUE        1     31   4.16         83</span>
</span><span class="line"><span class="c1">## 2 plot-2           TRUE           TRUE        3     41   5.82        175</span>
</span><span class="line"><span class="c1">## 3 plot-2           TRUE           TRUE        1     42   3.51         72</span>
</span><span class="line"><span class="c1">## 4 plot-2           TRUE          FALSE        1     64   7.16        125</span>
</span><span class="line"><span class="c1">## 5 plot-2           TRUE          FALSE        1     47   6.17        212</span>
</span><span class="line"><span class="c1">## 6 plot-2           TRUE          FALSE        1     52   5.32        114</span>
</span><span class="line"><span class="c1">##   Seeds.in.25.heads</span>
</span><span class="line"><span class="c1">## 1                 7</span>
</span><span class="line"><span class="c1">## 2                 0</span>
</span><span class="line"><span class="c1">## 3                32</span>
</span><span class="line"><span class="c1">## 4                22</span>
</span><span class="line"><span class="c1">## 5                 3</span>
</span><span class="line"><span class="c1">## 6                19</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>No.stems</code>, <code>Height</code>, <code>Weight</code>, <code>Seed.heads</code>, <code>Seeds.in.25.heads</code>.</p>

<p>What if we wanted to get the mean of each column?</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">mean.no.stems <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>No.stems<span class="p">)</span>
</span><span class="line">mean.Height <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">)</span>
</span><span class="line">mean.Weight <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Weight<span class="p">)</span>
</span><span class="line">mean.Seed.heads <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Seed.heads<span class="p">)</span>
</span><span class="line">mean.Seeds.in.25.heads <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Seeds.in.25.heads<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>What if we wanted to get the variance of all these?  Copy and paste
and change the function name?  Very repetitive, hard to see intent,
easy to make mistakes, and <strong>boring</strong>.</p>

<p>Notice the pattern though — we are taking each column in turn and
applying the same function to it.  Sombody else noticed this
pattern too.</p>

<p>The function that we will use is <code>sapply</code>.  It takes as its first
argument a list, and applies a function to each element in turn.</p>

<p>As a simple example, here is a little list with toy data:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">obj <span class="o">&lt;-</span> list<span class="p">(</span>a <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">5</span><span class="p">,</span> b <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> c <span class="o">=</span> c<span class="p">(</span>pi<span class="p">,</span> exp<span class="p">(</span><span class="m">1</span><span class="p">)))</span>
</span><span class="line">obj
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1] 1 2 3 4 5</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1] 1 5 6</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 3.142 2.718</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This computes the length of each element in <code>obj</code></p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> length<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## a b c </span>
</span><span class="line"><span class="c1">## 5 3 2</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This computes their sum</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> sum<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##     a     b     c </span>
</span><span class="line"><span class="c1">## 15.00 12.00  5.86</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This computes the variance</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> var<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##      a      b      c </span>
</span><span class="line"><span class="c1">## 2.5000 7.0000 0.0896</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This works with any function you want to use as the second argument.</p>

<p>Here are our variables:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">response.variables <span class="o">&lt;-</span> c<span class="p">(</span><span class="s">&quot;No.stems&quot;</span><span class="p">,</span> <span class="s">&quot;Height&quot;</span><span class="p">,</span> <span class="s">&quot;Weight&quot;</span><span class="p">,</span> <span class="s">&quot;Seed.heads&quot;</span><span class="p">,</span> <span class="s">&quot;Seeds.in.25.heads&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><a href="data-types.html">Remember</a> when I said that a <code>data.frame</code> is like
a list; this is one case where we take advantage of that.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>data<span class="p">[</span>response.variables<span class="p">],</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##          No.stems            Height            Weight        Seed.heads </span>
</span><span class="line"><span class="c1">##             1.982            55.544            11.198           225.799 </span>
</span><span class="line"><span class="c1">## Seeds.in.25.heads </span>
</span><span class="line"><span class="c1">##            22.130</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This does all of the repetitive hard work that we did before, but
in one line.  Read it as:</p>

<p>“Apply to each element in <code>data</code> (subset by my response variables)
the function <code>mean</code>”</p>

<h2 id="exercise">Exercise</h2>

<p>The coefficient of variation is defined as the standard deviation
(square root of the variance) divided by the mean:
<script type="math/tex">\frac{\mathrm{x}}{\bar x}</script>.  Compute the coefficient of
variation of these variables, and tell me which variable has the
largest CV.</p>

<p>Hint:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">coef.variation <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    sqrt<span class="p">(</span>var<span class="p">(</span>x<span class="p">))</span><span class="o">/</span>mean<span class="p">(</span>x<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Did you just do</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>data<span class="p">[</span>response.variables<span class="p">],</span> coef.variation<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##          No.stems            Height            Weight        Seed.heads </span>
</span><span class="line"><span class="c1">##            0.8624            0.2850            0.8841            0.8195 </span>
</span><span class="line"><span class="c1">## Seeds.in.25.heads </span>
</span><span class="line"><span class="c1">##            0.7676</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>and look for the largest variable?</p>

<p>did you do:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">cvs <span class="o">&lt;-</span> sapply<span class="p">(</span>data<span class="p">[</span>response.variables<span class="p">],</span> coef.variation<span class="p">)</span>
</span><span class="line">which<span class="p">(</span>cvs <span class="o">==</span> max<span class="p">(</span>cvs<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## Weight </span>
</span><span class="line"><span class="c1">##      3</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>you can also do:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">which.max<span class="p">(</span>cvs<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## Weight </span>
</span><span class="line"><span class="c1">##      3</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Similarly, for minimum</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">which.min<span class="p">(</span>cvs<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## Height </span>
</span><span class="line"><span class="c1">##      2</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="note">Note</h2>

<p>There is a function <code>lapply</code> works well when you are not expecting
the same length output for the result of applying your function to
each element in the list.  It gives you the result back in a list,
for example</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">lapply<span class="p">(</span>obj<span class="p">,</span> sum<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1] 15</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1] 12</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 5.86</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>compared with:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> sum<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##     a     b     c </span>
</span><span class="line"><span class="c1">## 15.00 12.00  5.86</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This is has its uses.  For example, suppose we wanted to double all
the elements in <code>obj</code>.  We can’t just multiply this list by 2:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">obj <span class="o">*</span> <span class="m">2</span>  <span class="c1"># causes error</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## Error: non-numeric argument to binary operator</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>However, we can do this with <code>lapply</code>, as long as we have a
function that will double things:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">double <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="m">2</span> <span class="o">*</span> x
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Apply the <code>double</code> function to each element in our list:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">lapply<span class="p">(</span>obj<span class="p">,</span> double<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1]  2  4  6  8 10</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1]  2 10 12</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 6.283 5.437</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>We have to use <code>lapply</code> rather than <code>sapply</code> because the result of
the function on different elements is different lengths.</p>

<p>Note also that <code>sapply</code> actually does the same thing here.  But if
the elements of <code>obj</code> happened to have the same length they would
give different answers.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> double<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1]  2  4  6  8 10</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1]  2 10 12</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 6.283 5.437</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">obj2 <span class="o">&lt;-</span> list<span class="p">(</span>a <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> b <span class="o">=</span> c<span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">6</span><span class="p">),</span> c <span class="o">=</span> c<span class="p">(</span>pi<span class="p">,</span> exp<span class="p">(</span><span class="m">1</span><span class="p">),</span> log<span class="p">(</span><span class="m">10</span><span class="p">)))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Returns a list:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">lapply<span class="p">(</span>obj2<span class="p">,</span> double<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1] 2 4 6</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1]  2 10 12</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 6.283 5.437 4.605</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Returns a matrix:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj2<span class="p">,</span> double<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##      a  b     c</span>
</span><span class="line"><span class="c1">## [1,] 2  2 6.283</span>
</span><span class="line"><span class="c1">## [2,] 4 10 5.437</span>
</span><span class="line"><span class="c1">## [3,] 6 12 4.605</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This is probably more than you need to know right now, but it may
stick around in your head until needed.</p>

<h1 id="the-split--apply--combine-pattern">The split–apply–combine pattern</h1>

<p>Fairly often, you’ll want to do something like compute means for
each level of a treatment.  To compute the mean height given the
root herbivore treatment here we could do:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">height.with <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">[</span>data<span class="o">$</span>Root.herbivore<span class="p">])</span>
</span><span class="line">height.without <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">[</span><span class="o">!</span>data<span class="o">$</span>Root.herbivore<span class="p">])</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Remember read <code>!</code> as “not”.</p>

<p>(notice that plant height is taller when herbivores are absent).</p>

<p>However, suppose that we want to get mean height by <em>plot</em>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">height.2 <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">[</span>data<span class="o">$</span>Plot <span class="o">==</span> <span class="s">&quot;plot-2&quot;</span><span class="p">])</span>
</span><span class="line">height.4 <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">[</span>data<span class="o">$</span>Plot <span class="o">==</span> <span class="s">&quot;plot-4&quot;</span><span class="p">])</span>
</span><span class="line">height.6 <span class="o">&lt;-</span> mean<span class="p">(</span>data<span class="o">$</span>Height<span class="p">[</span>data<span class="o">$</span>Plot <span class="o">==</span> <span class="s">&quot;plot-6&quot;</span><span class="p">])</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>and so on until we go out of our minds.</p>

<p>There is a function <code>tapply</code> that automates this.</p>

<p>It’s arguments are</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">args<span class="p">(</span>tapply<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## function (X, INDEX, FUN = NULL, ..., simplify = TRUE) </span>
</span><span class="line"><span class="c1">## NULL</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The first argument, <code>X</code> is our <em>data</em> variable; the thing that we
want the means of.</p>

<p>The second argument, <code>INDEX</code> is the <em>grouping</em> variable; the thing
that we want means at each distinct value/level of.</p>

<p>The third argument, <code>FUN</code> is the function that you want to apply;
in our case <code>mean</code>.</p>

<p>So we have:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">tapply<span class="p">(</span>data<span class="o">$</span>Height<span class="p">,</span> data<span class="o">$</span>Plot<span class="p">,</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##  plot-2  plot-4  plot-6  plot-8 plot-10 plot-12 plot-14 plot-16 plot-18 </span>
</span><span class="line"><span class="c1">##   46.17   57.00   33.33   47.40   42.00   44.60   50.00   70.57   58.50 </span>
</span><span class="line"><span class="c1">## plot-20 plot-22 plot-24 plot-26 plot-28 plot-30 plot-32 plot-34 plot-36 </span>
</span><span class="line"><span class="c1">##   47.75   37.50   44.67   41.67   60.50   57.57   44.33   46.75   52.29 </span>
</span><span class="line"><span class="c1">## plot-38 plot-40 plot-42 plot-44 plot-46 plot-48 plot-50 plot-52 plot-54 </span>
</span><span class="line"><span class="c1">##   56.80   65.56   32.50   56.17   54.57   55.17   73.25   68.86   58.43 </span>
</span><span class="line"><span class="c1">## plot-56 plot-58 plot-60 </span>
</span><span class="line"><span class="c1">##   54.67   60.00   73.62</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>For the first example (present/absent) we have:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">tapply<span class="p">(</span>data<span class="o">$</span>Height<span class="p">,</span> data<span class="o">$</span>Root.herbivore<span class="p">,</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## FALSE  TRUE </span>
</span><span class="line"><span class="c1">## 63.76 51.25</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Notice that there was no more work going from 2 levels to 30
levels!</p>

<p>Also notice that it’s really easy to change variables (as above) or
change functions:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">tapply<span class="p">(</span>data<span class="o">$</span>Height<span class="p">,</span> data<span class="o">$</span>Root.herbivore<span class="p">,</span> var<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## FALSE  TRUE </span>
</span><span class="line"><span class="c1">## 218.3 215.5</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This approach has been called the “split–apply-combine” pattern.
There is a package <a href="http://plyr.had.co.nz/">plyr</a> that a lot of
people like that can make this easier.</p>

<h2 id="two-factors-at-once">Two factors at once</h2>

<p>The experiment here is a 2x2 factorial design (though imbalanced as
all ecological data end up being after they’ve been left in the
field for a while).</p>

<p>You can do that with <code>tapply</code> above, but it gets quite hard.  The
<code>aggregate</code> function can do this nicely though.</p>

<p>There are two interfaces to this (see the help page <code>?aggregate</code>).
In the first, you supply the response variable as the first
argument, the grouping variables as the second, and the function as
the third (just like <code>tapply</code>).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">aggregate<span class="p">(</span>data<span class="o">$</span>Height<span class="p">,</span> data<span class="p">[</span>c<span class="p">(</span><span class="s">&quot;Root.herbivore&quot;</span><span class="p">,</span> <span class="s">&quot;Seed.herbivore&quot;</span><span class="p">)],</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##   Root.herbivore Seed.herbivore     x</span>
</span><span class="line"><span class="c1">## 1          FALSE          FALSE 68.27</span>
</span><span class="line"><span class="c1">## 2           TRUE          FALSE 52.20</span>
</span><span class="line"><span class="c1">## 3          FALSE           TRUE 58.93</span>
</span><span class="line"><span class="c1">## 4           TRUE           TRUE 50.14</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>or similarly, take a 1 column data frame:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">aggregate<span class="p">(</span>data<span class="p">[</span><span class="s">&quot;Height&quot;</span><span class="p">],</span> data<span class="p">[</span>c<span class="p">(</span><span class="s">&quot;Root.herbivore&quot;</span><span class="p">,</span> <span class="s">&quot;Seed.herbivore&quot;</span><span class="p">)],</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##   Root.herbivore Seed.herbivore Height</span>
</span><span class="line"><span class="c1">## 1          FALSE          FALSE  68.27</span>
</span><span class="line"><span class="c1">## 2           TRUE          FALSE  52.20</span>
</span><span class="line"><span class="c1">## 3          FALSE           TRUE  58.93</span>
</span><span class="line"><span class="c1">## 4           TRUE           TRUE  50.14</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The other interface uses R’s formula interface, which can be a lot
shorter and easier to read.  </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">aggregate<span class="p">(</span>Height <span class="o">~</span> Root.herbivore <span class="o">+</span> Seed.herbivore<span class="p">,</span> data <span class="o">=</span> data<span class="p">,</span> mean<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##   Root.herbivore Seed.herbivore Height</span>
</span><span class="line"><span class="c1">## 1          FALSE          FALSE  68.27</span>
</span><span class="line"><span class="c1">## 2           TRUE          FALSE  52.20</span>
</span><span class="line"><span class="c1">## 3          FALSE           TRUE  58.93</span>
</span><span class="line"><span class="c1">## 4           TRUE           TRUE  50.14</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This is why I think it is important to get used to writing
functions:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">standard.error <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    sqrt<span class="p">(</span>var<span class="p">(</span>x<span class="p">)</span><span class="o">/</span>length<span class="p">(</span>x<span class="p">))</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Because your own functions work just as well with these tools:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">aggregate<span class="p">(</span>Height <span class="o">~</span> Root.herbivore <span class="o">+</span> Seed.herbivore<span class="p">,</span> data <span class="o">=</span> data<span class="p">,</span> standard.error<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##   Root.herbivore Seed.herbivore Height</span>
</span><span class="line"><span class="c1">## 1          FALSE          FALSE  2.408</span>
</span><span class="line"><span class="c1">## 2           TRUE          FALSE  1.761</span>
</span><span class="line"><span class="c1">## 3          FALSE           TRUE  2.848</span>
</span><span class="line"><span class="c1">## 4           TRUE           TRUE  2.224</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>(now you have everything for an interaction plot to start seeing
how the different herbivores interact to effect plant growth).</p>

<h1 id="explicit-loops">Explicit loops</h1>

<p>In contrast with most programming languages, we have not covered a
basic loop yet.  You may be familiar with these if you’ve written
basic, python, perl, etc.</p>

<p>The idea is the same as the first section in this page.  You want
to apply a function (or do some calculation) over a series of
elements in a list.</p>

<p>For example, the <code>print</code> function prints a representation of an
object to the screen.  Suppose we wanted to print all the elements
of our list <code>obj</code>.</p>

<p>This is confusing!</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">sapply<span class="p">(</span>obj<span class="p">,</span> print<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## [1] 1 2 3 4 5</span>
</span><span class="line"><span class="c1">## [1] 1 5 6</span>
</span><span class="line"><span class="c1">## [1] 3.142 2.718</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## $a</span>
</span><span class="line"><span class="c1">## [1] 1 2 3 4 5</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $b</span>
</span><span class="line"><span class="c1">## [1] 1 5 6</span>
</span><span class="line"><span class="c1">## </span>
</span><span class="line"><span class="c1">## $c</span>
</span><span class="line"><span class="c1">## [1] 3.142 2.718</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This is because we want to just print the result to the screen and
we don’t actually want to do anything with the result (it turns out
that <code>print</code> silently returns what is passed into it.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kr">for</span> <span class="p">(</span>el <span class="kr">in</span> obj<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    print<span class="p">(</span>el<span class="p">)</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## [1] 1 2 3 4 5</span>
</span><span class="line"><span class="c1">## [1] 1 5 6</span>
</span><span class="line"><span class="c1">## [1] 3.142 2.718</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>The element <code>i</code> is created at the beginning of the loop, and set to
the first element in obj.  Each time “around” the loop it is set to
the next element (so on the second iteration it will be the second
element, and so on).</p>

<p>Note that in contrast with functions, the variables created by
loops do actually replace things in the global environment:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">el
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## [1] 3.142 2.718</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Strictly, in the <em>enclosing environment</em>, so a loop within a
function leaves the global environment unaffected.</p>

<p>If you want to <em>do</em> something with the results of the loop, you
need more scaffolding.  Let’s do the mean example again and get the
mean of each element in the list.</p>

<p>First, we need somewhere to put the output.  The function <code>numeric</code>
creates a numeric vector of the requested length.  </p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">n <span class="o">&lt;-</span> length<span class="p">(</span>obj<span class="p">)</span>
</span><span class="line">out <span class="o">&lt;-</span> numeric<span class="p">(</span>n<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>You could use <code>rep</code> here if you’d rather.</p>

<p>Then, rather than loop over the elements directly as above, we loop
over their <em>indices</em>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>n<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    out<span class="p">[</span>i<span class="p">]</span> <span class="o">&lt;-</span> mean<span class="p">(</span>obj<span class="p">[[</span>i<span class="p">]])</span>
</span><span class="line"><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Read the line within the loop as “into the i’th element of output
(<code>out</code>) save the result of running the function on the i’th element
if the input (<code>obj</code>)”.  The double square brackets are needed (Why?
Because <code>out[i]</code> would be a list with one element while <code>out[[i]]</code>
is the <code>i</code>th element itself.).</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">out
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">## [1] 3.00 4.00 2.93</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>This does not have names like the <code>sapply</code> version did.  If we want
names, add them back with <code>names</code>.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">names<span class="p">(</span>out<span class="p">)</span> <span class="o">&lt;-</span> names<span class="p">(</span>obj<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>There are times where loops are absolutely the best (or the only
way) of doing something.</p>

<p>For example, if you want a cumulative sum over list elements (so
that <code>out[[i]]</code> contains the sum of <code>obj[[1]]</code>, <code>obj[[2]]</code>, …,
<code>obj[[i]]</code>), you might do that with a loop:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">n <span class="o">&lt;-</span> length<span class="p">(</span>obj<span class="p">)</span>
</span><span class="line">out <span class="o">&lt;-</span> numeric<span class="p">(</span>n<span class="p">)</span>
</span><span class="line">total <span class="o">&lt;-</span> <span class="m">0</span>  <span class="c1"># running total</span>
</span><span class="line"><span class="kr">for</span> <span class="p">(</span>i <span class="kr">in</span> <span class="m">1</span><span class="o">:</span>n<span class="p">)</span> <span class="p">{</span>
</span><span class="line">    total <span class="o">&lt;-</span> total <span class="o">+</span> sum<span class="p">(</span>obj<span class="p">[[</span>i<span class="p">]])</span>
</span><span class="line">    out<span class="p">[[</span>i<span class="p">]]</span> <span class="o">&lt;-</span> total
</span><span class="line"><span class="p">}</span>
</span><span class="line">names<span class="p">(</span>out<span class="p">)</span> <span class="o">&lt;-</span> names<span class="p">(</span>obj<span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Although we can actually do that with the built-in function
<code>cumsum</code> and <code>sapply</code>ing over the list to get the sums.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="r"><span class="line">cumsum<span class="p">(</span>sapply<span class="p">(</span>obj<span class="p">,</span> sum<span class="p">))</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="r"><span class="line"><span class="c1">##     a     b     c </span>
</span><span class="line"><span class="c1">## 15.00 27.00 32.86</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<hr />
<p>Back to <a href="/intro">main page</a></p>

  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013-05-17-organising-my-project/">Organizing the project directory</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-05-14-modifying-data-with-lookup-tables/">Modifying data with lookup tables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-05-14-modifying-data-with-lookup-tables/">Modifying data with lookup tables</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-05-07-how-long-is-a-function/">How long is a function?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013-04-30-excel-and-line-endings/">Excel and line endings</a>
      </li>
    
  </ul>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Rich FitzJohn & Daniel Falster -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'nicercode';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://nicercode.github.com/intro/repeating-things.html';
        var disqus_url = 'http://nicercode.github.com/intro/repeating-things.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
